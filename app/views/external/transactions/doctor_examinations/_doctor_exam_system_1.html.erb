<%
    namespacing ||= "de_attributes_#{ rand(1000) }"
    readonly    ||= false
%>

<div class="category-switchable hidden" data-type="system_1">
    <div class="p-4 border-bottom">
        <h3><u>PART III. PHYSICAL EXAMINATION Section B: Systems Examination</u></h3>
    </div>

    <h5 class="px-4 py-3 border-bottom mb-0">Section B - System's Examination</h5>

    <div class="px-4 py-2 d-flex flex-wrap justify-content-end align-items-center border-bottom">
        <label class="row-index">1</label>
        <label class="flex-grow-1 mb-0">Cardiovascular system</label>
    </div>

    <% DoctorExamination.cardiovascular.each_with_index do |array, index| %>
        <%
            field_name, label = array
            value = doctor_examination.try(field_name)
        %>

        <div class="px-4 py-2 boolean-field-parent d-flex flex-wrap justify-content-end align-items-center border-bottom">
            <label class="row-index"><%= "1.#{ index + 1 }" %></label>
            <label class="flex-grow-1 mb-0"><%= label %></label>

            <div class="d-flex flex-shrink-0">
                <%= hidden_field_tag "#{ namespacing }[#{ field_name }]", value, class: "boolean-field #{ "auto-field-check--heart" if field_name == :system_cardiovascular_heart_sounds }" %>
                <%= raw boolean_field_button(active_color: "danger", active: value, readonly: readonly, value: true, placeholder: "Abnormal") %>
                <%= raw boolean_field_button(active_color: "success", active: !value, readonly: readonly, value: false, placeholder: "Normal") %>
            </div>
        </div>
    <% end %>

    <div class="px-4 py-2 d-flex flex-wrap justify-content-end align-items-center border-bottom">
        <label class="row-index">2</label>
        <label class="flex-grow-1 mb-0">Respiratory system</label>
    </div>

    <% DoctorExamination.respiratory.each_with_index do |array, index| %>
        <%
            field_name, label = array
            value = doctor_examination.try(field_name)
        %>

        <div class="px-4 py-2 boolean-field-parent d-flex flex-wrap justify-content-end align-items-center border-bottom">
            <label class="row-index"><%= "2.#{ index + 1 }" %></label>
            <label class="flex-grow-1 mb-0"><%= label %></label>

            <div class="d-flex flex-shrink-0">
                <%= hidden_field_tag "#{ namespacing }[#{ field_name }]", value, class: "boolean-field" %>
                <%= raw boolean_field_button(active_color: "danger", active: value, readonly: readonly, value: true, placeholder: "Abnormal") %>
                <%= raw boolean_field_button(active_color: "success", active: !value, readonly: readonly, value: false, placeholder: "Normal") %>
            </div>
        </div>
    <% end %>

    <div class="px-4 py-2 d-flex flex-wrap justify-content-end align-items-center border-bottom">
        <label class="row-index">3</label>
        <label class="flex-grow-1 mb-0">Gastrointestinal system</label>
    </div>

    <% DoctorExamination.gastrointestinal.each_with_index do |array, index| %>
        <%
            field_name, label = array
            value = doctor_examination.try(field_name)
        %>

        <div class="px-4 py-2 boolean-field-parent d-flex flex-wrap justify-content-end align-items-center border-bottom">
            <label class="row-index"><%= "3.#{ index + 1 }" %></label>
            <label class="flex-grow-1 mb-0"><%= label %></label>

            <div class="d-flex flex-shrink-0">
                <%= hidden_field_tag "#{ namespacing }[#{ field_name }]", value, class: "boolean-field" %>
                <%= raw boolean_field_button(active_color: "danger", active: value, readonly: readonly, value: true, placeholder: "Abnormal") %>
                <%= raw boolean_field_button(active_color: "success", active: !value, readonly: readonly, value: false, placeholder: "Normal") %>
            </div>
        </div>
    <% end %>

    <% unless readonly %>
        <div class="px-4 py-2 boolean-field-parent d-flex flex-wrap justify-content-end align-items-center border-bottom">
            <label class="row-index"></label>
            <label class="flex-grow-1 mb-0">Yes, I have visited system exam 1 for this foreign worker</label>

            <div class="d-flex flex-shrink-0">
                <% value = doctor_examination.try(:visited_system_1) %>
                <%= hidden_field_tag "#{ namespacing }[visited_system_1]", value, class: "boolean-field visited-bool" %>
                <%= raw boolean_field_button(active_color: "success", active: value, readonly: readonly, value: true, placeholder: "Yes") %>
                <%= raw boolean_field_button(active_color: "danger", active: !value, readonly: readonly, value: false, placeholder: "No") %>
            </div>
        </div>
    <% end %>
</div>